<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Hello! Helper ‚Äì Smart Search</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
  * { box-sizing: border-box; }

  body {
    margin: 0;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
    background: radial-gradient(circle at top left, #fdf2ff 0, #f5fbff 40%, #e0ecff 80%);
    overflow: hidden;
  }

  #app {
    width: 100%;
    height: 100vh;
    position: relative;
  }

  /* --- Frosted Glass Helper UI --- */
  #helper {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 440px; /* wider */
    max-width: 92vw;
    transform: translate(-50%, -50%);
    background: rgba(255, 255, 255, 0.24); /* real transparency */
    border-radius: 22px;
    padding: 18px 20px 16px;
    border: 1px solid rgba(255, 255, 255, 0.55);
    box-shadow: 0 18px 55px rgba(20, 25, 42, 0.40);
    backdrop-filter: blur(26px) saturate(180%);
    -webkit-backdrop-filter: blur(26px) saturate(180%);
    color: #111;
    z-index: 10;
  }
  #helper.hidden { display: none; }

  .title {
    font-size: 19px; /* slightly smaller */
    font-weight: 650;
    margin-bottom: 4px;
  }

  .subtitle {
    font-size: 13px;
    opacity: 0.75;
    margin-bottom: 12px;
  }

  #search {
    width: 100%;
    padding: 9px 11px;
    border-radius: 10px;
    border: 1px solid rgba(148, 163, 184, 0.6);
    font-size: 14px;
    background: rgba(255, 255, 255, 0.88);
    outline: none;
  }

  #search:focus {
    border-color: #3b82f6;
    box-shadow: 0 0 0 1px rgba(59, 130, 246, 0.35);
  }

  .chips {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin: 10px 0 8px;
  }

  .chip {
    padding: 4px 9px;
    border-radius: 999px;
    font-size: 11px;
    background: rgba(255, 255, 255, 0.85);
    border: 1px solid rgba(148, 163, 184, 0.6);
    cursor: pointer;
    white-space: nowrap;
  }

  .chip:hover {
    background: rgba(239, 246, 255, 0.95);
  }

  #results {
    max-height: 280px;
    overflow-y: auto;
    padding-right: 4px;
  }

  .result {
    padding: 8px 9px;
    background: rgba(255, 255, 255, 0.82);
    border-radius: 10px;
    margin-bottom: 6px;
    cursor: pointer;
    border: 1px solid rgba(148, 163, 184, 0.35);
    transition: background 0.15s, transform 0.08s;
  }
  .result:hover {
    background: #eff6ff;
    transform: translateY(-1px);
  }

  .result-title {
    font-size: 13px;
    font-weight: 600;
    margin-bottom: 2px;
  }
  .result-desc {
    font-size: 11px;
    opacity: 0.82;
    line-height: 1.3;
  }

  .empty {
    font-size: 12px;
    opacity: 0.7;
    margin-top: 6px;
  }

  #status {
    font-size: 10px;
    opacity: 0.65;
    margin-top: 6px;
  }

  /* --- Content Viewer with Header --- */
  #viewer-wrap {
    display: none;  
    position: absolute;
    inset: 0;
    z-index: 3;
    background: white;
    display: flex;
    flex-direction: column;
  }
  #viewer-wrap.visible {
    display: flex;
  }

  #viewer-header {
    width: 100%;
    height: 42px;
    background: rgba(255,255,255,0.85);
    backdrop-filter: blur(14px);
    -webkit-backdrop-filter: blur(14px);
    border-bottom: 1px solid rgba(0,0,0,0.06);
    display: flex;
    justify-content: flex-end;
    align-items: center;
    padding-right: 10px;
  }

  #viewer {
    flex: 1;
    border: none;
    width: 100%;
  }

  /* Floating pill INSIDE header now */
  #pill {
    background: rgba(15, 23, 42, 0.88);
    color: #f9fafb;
    padding: 8px 13px;
    border-radius: 999px;
    font-size: 12px;
    cursor: pointer;
    display: none;
    backdrop-filter: blur(14px);
    box-shadow: 0 4px 20px rgba(15, 23, 42, 0.45);
  }
  #pill.visible {
    display: inline-flex;
    align-items: center;
    gap: 4px;
  }
</style>
</head>

<body>
<div id="app">
  <!-- SEARCH PANEL -->
  <div id="helper">
    <div class="title">Hello! Helper</div>
    <div class="subtitle">Type what you‚Äôre trying to do or tap a suggestion.</div>

    <input id="search" placeholder="Search for help, features, or topics‚Ä¶" autocomplete="off" />

    <div class="chips">
      <div class="chip" data-q="public link">Public link</div>
      <div class="chip" data-q="embed card">Embed card</div>
      <div class="chip" data-q="filter spam requests">Filter requests</div>
    </div>

    <div id="results" class="empty">Start typing or tap a suggestion.</div>
    <div id="status"></div>
  </div>

  <!-- CONTENT VIEWER -->
  <div id="viewer-wrap">
    <div id="viewer-header">
      <div id="pill">üîç Search</div>
    </div>
    <iframe id="viewer"></iframe>
  </div>
</div>

<script>
/* SAME JS AS PREVIOUS VERSION ‚Äî only UI changed */
const SHEET_URL =
  "https://docs.google.com/spreadsheets/d/e/2PACX-1vSyssmgugx1VUcyPbrjiOul67XjNNbFp45EIBinkDhqO-MK52t0qks5bbEoudn1bVtwuz5TyA_OaChW/pub?output=csv";

let knowledgeIndex = [];
let indexLoaded = false;
const searchInput = document.getElementById("search");
const resultsDiv = document.getElementById("results");
const helper = document.getElementById("helper");
const statusEl = document.getElementById("status");
const viewerWrap = document.getElementById("viewer-wrap");
const viewer = document.getElementById("viewer");
const pill = document.getElementById("pill");

function tokenize(text) {
  return text.toLowerCase().split(/[^a-z0-9]+/g).filter(Boolean);
}

const SYNONYMS = {
  spam: ["noise", "unwanted", "junk", "cold", "salesy", "unsolicited"],
  public: ["visible", "everyone", "open", "shareable"],
  share: ["send", "distribute", "copy", "forward"],
  embed: ["iframe", "website", "paste", "integrate", "install"],
  filter: ["screen", "gate", "approve", "qualify", "block"],
  request: ["inquiry", "message", "contact"],
  profile: ["card", "page", "presence"],
  link: ["url", "address"],
  qr: ["scan", "code"],
};

function getSynonyms(token) {
  const out = new Set();
  if (SYNONYMS[token]) SYNONYMS[token].forEach(s => out.add(s));
  for (const [k, v] of Object.entries(SYNONYMS))
    if (v.includes(token)) out.add(k);
  return [...out];
}

async function loadSheet() {
  const res = await fetch(SHEET_URL);
  const text = await res.text();
  const rows = text.trim().split("\n");
  rows.shift(); // remove header
  knowledgeIndex = rows.map(r => {
    const [title, url, desc, tags, notes] = r.split(",");
    const text = `${title} ${desc} ${tags} ${notes} `.toLowerCase();
    return {
      title,
      url,
      desc,
      tags,
      notes,
      _text: text,
      _tokens: new Set(tokenize(text)),
    };
  });
  indexLoaded = true;
}

function score(entry, q) {
  let s = 0;
  const full = q.toLowerCase();
  if (entry._text.includes(full)) s += 6;
  for (const tok of tokenize(q)) {
    if (entry._tokens.has(tok)) s += 5;
    else if (getSynonyms(tok).some(syn => entry._text.includes(syn))) s += 3;
    else if ([...entry._tokens].some(t => t.startsWith(tok))) s += 2;
  }
  return s;
}

async function search(q) {
  if (!indexLoaded || q.trim().length < 2) return [];
  return knowledgeIndex
    .map(e => ({ e, s: score(e, q) }))
    .filter(x => x.s > 0)
    .sort((a, b) => b.s - a.s)
    .map(x => x.e);
}

searchInput.addEventListener("input", async () => {
  const q = searchInput.value;
  if (!q.trim()) {
    resultsDiv.innerHTML = "Start typing or tap a suggestion.";
    return;
  }
  resultsDiv.innerHTML = `<div class="empty">Searching‚Ä¶</div>`;
  const results = await search(q);
  if (!results.length) {
    resultsDiv.innerHTML = `<div class="empty">No results found.</div>`;
    return;
  }
  resultsDiv.innerHTML = results.map(r => `
    <div class="result" data-url="${r.url}">
      <div class="result-title">${r.title}</div>
      <div class="result-desc">${r.desc}</div>
    </div>`).join("");

  document.querySelectorAll(".result").forEach(el =>
    el.onclick = () => openContent(el.dataset.url)
  );
});

document.querySelectorAll(".chip").forEach(el =>
  el.onclick = () => {
    searchInput.value = el.dataset.q;
    searchInput.dispatchEvent(new Event("input"));
  }
);

function openContent(url) {
  viewer.src = url;
  viewerWrap.classList.add("visible");
  helper.classList.add("hidden");
  pill.classList.add("visible");
}

pill.onclick = () => {
  viewerWrap.classList.remove("visible");
  helper.classList.remove("hidden");
  pill.classList.remove("visible");
  viewer.src = "";
};

(async function init() {
  statusEl.textContent = "Loading help topics‚Ä¶";
  await loadSheet();
  statusEl.textContent = "Smart search ready ‚úî";
})();
</script>
</body>
</html>
